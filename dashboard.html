<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Avila Pulse</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- SQL.js - SQLite for Browser -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>

    <!-- Iconoir Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/iconoir-icons/iconoir@main/css/iconoir.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0A84FF;
            --secondary: #BF5AF2;
            --success: #34C759;
            --warning: #FFD60A;
            --danger: #FF375F;
            --purple: #BF5AF2;
            --pink: #FF375F;
            --gold: #FFD60A;
            --dark: #000000;
            --dark-light: #1D1D1F;
            --card-bg: rgba(255, 255, 255, 0.05);
            --text: #F5F5F7;
            --text-muted: #98989D;
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: #000000;
            color: var(--text);
            min-height: 100vh;
            font-weight: 400;
            letter-spacing: -0.01em;
            position: relative;
            overflow-x: hidden;
        }

        /* Background Effects */
        body::before {
            content: '';
            position: fixed;
            top: -200px;
            left: -200px;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(10, 132, 255, 0.15), transparent);
            border-radius: 50%;
            filter: blur(80px);
            z-index: 0;
            pointer-events: none;
            animation: float 8s ease-in-out infinite;
        }

        body::after {
            content: '';
            position: fixed;
            bottom: -200px;
            right: -200px;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(191, 90, 242, 0.15), transparent);
            border-radius: 50%;
            filter: blur(80px);
            z-index: 0;
            pointer-events: none;
            animation: float 10s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-20px) translateX(10px); }
            50% { transform: translateY(-10px) translateX(-10px); }
            75% { transform: translateY(-30px) translateX(5px); }
        }

        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 600;
            color: #F5F5F7;
            text-decoration: none;
            letter-spacing: -0.02em;
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #F5F5F7;
            border: 1px solid var(--border);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(10, 132, 255, 0.3);
        }

        /* Sidebar */
        .dashboard-layout {
            display: flex;
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .sidebar {
            width: 250px;
            background: rgba(255, 255, 255, 0.03);
            border-right: 1px solid var(--border);
            padding: 2rem 1rem;
            min-height: calc(100vh - 70px);
            backdrop-filter: blur(20px);
        }

        .sidebar-nav {
            list-style: none;
        }

        .sidebar-nav li {
            margin-bottom: 0.5rem;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--text-muted);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            background: rgba(10, 132, 255, 0.1);
            color: var(--primary);
            border-left: 3px solid var(--primary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        /* Metrics Cards */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            border-color: rgba(10, 132, 255, 0.5);
            box-shadow: 0 12px 40px rgba(10, 132, 255, 0.2);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .metric-title {
            color: var(--text-muted);
            font-size: 0.875rem;
            text-transform: uppercase;
            font-weight: 600;
        }

        .metric-icon {
            font-size: 1.5rem;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        .metric-change {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
        }

        .metric-change.positive {
            color: var(--success);
        }

        .metric-change.negative {
            color: var(--danger);
        }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
        }

        .chart-card:hover {
            transform: translateY(-5px);
            border-color: rgba(10, 132, 255, 0.5);
        }

        .chart-card canvas {
            height: 300px !important;
            width: 100% !important;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #F5F5F7;
            letter-spacing: -0.01em;
        }

        .chart-controls {
            display: flex;
            gap: 0.5rem;
        }

        .chart-controls button {
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-muted);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .chart-controls button.active,
        .chart-controls button:hover {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-color: transparent;
        }

        /* Notifications */
        .notifications {
            position: fixed;
            top: 5rem;
            right: 2rem;
            z-index: 1000;
            max-width: 400px;
        }

        .notification {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            gap: 1rem;
            animation: slideIn 0.3s ease-out;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.warning {
            border-left: 4px solid var(--warning);
        }

        .notification.danger {
            border-left: 4px solid var(--danger);
        }

        .notification-icon {
            font-size: 1.5rem;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: #F5F5F7;
        }

        .notification-message {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.25rem;
        }

        /* Live Status */
        .live-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 20px;
            font-size: 0.875rem;
            color: var(--success);
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: livePulse 2s ease-in-out infinite;
        }

        @keyframes livePulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(1.2);
            }
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        select,
        input[type="date"] {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.05);
            color: #F5F5F7;
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Settings Modal */
        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .settings-modal.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .settings-content {
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 2rem;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(10, 132, 255, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .settings-header h2 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .settings-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .settings-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #F5F5F7;
        }

        .settings-section {
            margin-bottom: 2rem;
        }

        .settings-section h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #F5F5F7;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .settings-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            transition: all 0.3s;
        }

        .settings-group:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(10, 132, 255, 0.3);
        }

        .settings-info {
            flex: 1;
        }

        .settings-info label {
            font-weight: 600;
            color: #F5F5F7;
            display: block;
            margin-bottom: 0.25rem;
        }

        .settings-info small {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border);
            transition: 0.4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-color: transparent;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .settings-select {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.05);
            color: #F5F5F7;
            font-size: 0.9rem;
            min-width: 150px;
        }

        .settings-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .btn-reset {
            background: rgba(255, 55, 95, 0.1);
            color: var(--danger);
            border: 1px solid rgba(255, 55, 95, 0.3);
        }

        .btn-reset:hover {
            background: var(--danger);
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                min-height: auto;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .notifications {
                right: 1rem;
                left: 1rem;
                max-width: none;
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">
                <span>üìä</span>
                <span>Avila Pulse</span>
            </a>
            <div class="header-controls">
                <div class="live-status">
                    <span class="live-dot"></span>
                    <span>Live</span>
                </div>
                <button class="btn btn-secondary" onclick="showDatabaseStats()" title="Ver estat√≠sticas do banco de dados">
                    <i class="iconoir-database"></i>
                    DB Stats
                </button>
                <button class="btn btn-secondary" onclick="exportData()">
                    <i class="iconoir-download"></i>
                    Exportar
                </button>
                <button class="btn btn-primary" onclick="toggleSettings()">
                    <i class="iconoir-settings"></i>
                    Configura√ß√µes
                </button>
            </div>
        </div>
    </header>

    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <ul class="sidebar-nav">
                <li><a href="#" class="active"><i class="iconoir-dashboard-speed"></i> Overview</a></li>
                <li><a href="#"><i class="iconoir-graph-up"></i> Analytics</a></li>
                <li><a href="#"><i class="iconoir-bell"></i> Alertas</a></li>
                <li><a href="#"><i class="iconoir-server"></i> Servidores</a></li>
                <li><a href="#"><i class="iconoir-database"></i> Databases</a></li>
                <li><a href="/AI"><i class="iconoir-brain"></i> Agentes IA</a></li>
                <li><a href="#"><i class="iconoir-settings"></i> Configura√ß√µes</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Filters -->
            <div class="filters">
                <select id="periodFilter" onchange="updateCharts()">
                    <option value="1h">√öltima Hora</option>
                    <option value="24h" selected>√öltimas 24h</option>
                    <option value="7d">√öltimos 7 dias</option>
                    <option value="30d">√öltimos 30 dias</option>
                </select>
                <select id="metricFilter" onchange="updateCharts()">
                    <option value="all">Todas as M√©tricas</option>
                    <option value="performance">Performance</option>
                    <option value="users">Usu√°rios</option>
                    <option value="errors">Erros</option>
                </select>
                <input type="date" id="startDate" onchange="updateCharts()">
                <input type="date" id="endDate" onchange="updateCharts()">
            </div>

            <!-- Metrics Cards -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Total de Eventos</span>
                        <span class="metric-icon">‚ö°</span>
                    </div>
                    <div class="metric-value" id="totalEvents">0</div>
                    <div class="metric-change positive">
                        <i class="iconoir-arrow-up"></i>
                        <span>+12.5%</span>
                        <span style="color: var(--text-muted); margin-left: 0.25rem;">vs ontem</span>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Usu√°rios Ativos</span>
                        <span class="metric-icon">üë•</span>
                    </div>
                    <div class="metric-value" id="activeUsers">0</div>
                    <div class="metric-change positive">
                        <i class="iconoir-arrow-up"></i>
                        <span>+8.3%</span>
                        <span style="color: var(--text-muted); margin-left: 0.25rem;">vs ontem</span>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Lat√™ncia M√©dia</span>
                        <span class="metric-icon">‚è±Ô∏è</span>
                    </div>
                    <div class="metric-value" id="avgLatency">0<span style="font-size: 1rem;">ms</span></div>
                    <div class="metric-change negative">
                        <i class="iconoir-arrow-down"></i>
                        <span>-3.2%</span>
                        <span style="color: var(--text-muted); margin-left: 0.25rem;">melhor</span>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Taxa de Erro</span>
                        <span class="metric-icon">üö®</span>
                    </div>
                    <div class="metric-value" id="errorRate">0<span style="font-size: 1rem;">%</span></div>
                    <div class="metric-change positive">
                        <i class="iconoir-arrow-down"></i>
                        <span>-15.7%</span>
                        <span style="color: var(--text-muted); margin-left: 0.25rem;">melhor</span>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Eventos em Tempo Real</h3>
                        <div class="chart-controls">
                            <button class="active" onclick="changeChartPeriod('events', '1h')">1h</button>
                            <button onclick="changeChartPeriod('events', '24h')">24h</button>
                            <button onclick="changeChartPeriod('events', '7d')">7d</button>
                        </div>
                    </div>
                    <canvas id="eventsChart"></canvas>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Usu√°rios Simult√¢neos</h3>
                        <div class="chart-controls">
                            <button class="active" onclick="changeChartPeriod('users', '1h')">1h</button>
                            <button onclick="changeChartPeriod('users', '24h')">24h</button>
                            <button onclick="changeChartPeriod('users', '7d')">7d</button>
                        </div>
                    </div>
                    <canvas id="usersChart"></canvas>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Performance (Lat√™ncia)</h3>
                        <div class="chart-controls">
                            <button class="active" onclick="changeChartPeriod('latency', '1h')">1h</button>
                            <button onclick="changeChartPeriod('latency', '24h')">24h</button>
                            <button onclick="changeChartPeriod('latency', '7d')">7d</button>
                        </div>
                    </div>
                    <canvas id="latencyChart"></canvas>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Distribui√ß√£o de Erros</h3>
                        <div class="chart-controls">
                            <button class="active" onclick="changeChartPeriod('errors', '1h')">1h</button>
                            <button onclick="changeChartPeriod('errors', '24h')">24h</button>
                            <button onclick="changeChartPeriod('errors', '7d')">7d</button>
                        </div>
                    </div>
                    <canvas id="errorsChart"></canvas>
                </div>
            </div>
        </main>

        <!-- Footer discreto -->
        <div style="text-align: center; padding: 1rem; font-size: 0.75rem; color: #6E6E73;">
            <span style="opacity: 0.3;">|</span> <a href="https://dashboard.tawk.to/#/dashboard/694f28753169ac197f3faf8d" target="_blank" style="color: #48484A; text-decoration: none; opacity: 0.5; transition: opacity 0.3s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">¬∑</a>
        </div>
    </div>

    <!-- Notifications Container -->
    <div class="notifications" id="notifications"></div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <div class="settings-header">
                <h2><i class="iconoir-settings"></i> Configura√ß√µes</h2>
                <button class="settings-close" onclick="toggleSettings()">
                    <i class="iconoir-xmark"></i>
                </button>
            </div>

            <div class="settings-section">
                <h3><i class="iconoir-bell"></i> Notifica√ß√µes</h3>
                <div class="settings-group">
                    <div class="settings-info">
                        <label>Notifica√ß√µes Desktop</label>
                        <small>Receba alertas mesmo com aba inativa</small>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="desktopNotifications" onchange="saveSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-group">
                    <div class="settings-info">
                        <label>Alertas de Erro</label>
                        <small>Notificar quando taxa de erro exceder limite</small>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="errorAlerts" checked onchange="saveSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-group">
                    <div class="settings-info">
                        <label>Sons</label>
                        <small>Reproduzir som em alertas cr√≠ticos</small>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="soundAlerts" onchange="saveSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-section">
                <h3><i class="iconoir-refresh-double"></i> Atualiza√ß√£o Autom√°tica</h3>
                <div class="settings-group">
                    <div class="settings-info">
                        <label>Intervalo de Atualiza√ß√£o</label>
                        <small>Frequ√™ncia de refresh dos dados</small>
                    </div>
                    <select class="settings-select" id="refreshInterval" onchange="saveSettings()">
                        <option value="5000">5 segundos</option>
                        <option value="10000" selected>10 segundos</option>
                        <option value="30000">30 segundos</option>
                        <option value="60000">1 minuto</option>
                    </select>
                </div>
                <div class="settings-group">
                    <div class="settings-info">
                        <label>Auto-refresh</label>
                        <small>Atualizar dados automaticamente</small>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoRefresh" checked onchange="saveSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-section">
                <h3><i class="iconoir-graph-up"></i> Visualiza√ß√£o</h3>
                <div class="settings-group">
                    <div class="settings-info">
                        <label>Tema dos Gr√°ficos</label>
                        <small>Estilo visual dos charts</small>
                    </div>
                    <select class="settings-select" id="chartTheme" onchange="saveSettings()">
                        <option value="gradient" selected>Gradiente</option>
                        <option value="solid">S√≥lido</option>
                        <option value="minimal">Minimalista</option>
                    </select>
                </div>
                <div class="settings-group">
                    <div class="settings-info">
                        <label>Anima√ß√µes</label>
                        <small>Efeitos visuais e transi√ß√µes</small>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="animations" checked onchange="saveSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-group">
                    <div class="settings-info">
                        <label>Densidade de Dados</label>
                        <small>Quantidade de pontos nos gr√°ficos</small>
                    </div>
                    <select class="settings-select" id="dataPoints" onchange="saveSettings()">
                        <option value="12">Baixa (12 pontos)</option>
                        <option value="24" selected>M√©dia (24 pontos)</option>
                        <option value="48">Alta (48 pontos)</option>
                        <option value="96">Muito Alta (96 pontos)</option>
                    </select>
                </div>
            </div>

            <div class="settings-section">
                <h3><i class="iconoir-database"></i> Banco de Dados</h3>
                <div class="settings-group">
                    <div class="settings-info">
                        <label>Auto-save</label>
                        <small>Salvar dados automaticamente no localStorage</small>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="dbAutoSave" checked onchange="saveSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-group">
                    <div class="settings-info">
                        <label>Reten√ß√£o de Dados</label>
                        <small>Tempo de armazenamento das m√©tricas</small>
                    </div>
                    <select class="settings-select" id="dataRetention" onchange="saveSettings()">
                        <option value="24">24 horas</option>
                        <option value="72" selected>3 dias</option>
                        <option value="168">7 dias</option>
                        <option value="720">30 dias</option>
                    </select>
                </div>
            </div>

            <div class="settings-actions">
                <button class="btn btn-reset" onclick="resetSettings()">
                    <i class="iconoir-restart"></i> Restaurar Padr√µes
                </button>
                <button class="btn btn-primary" onclick="toggleSettings()">
                    <i class="iconoir-check"></i> Salvar
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========== SQLite Database Setup ==========
        let db;

        async function initDatabase() {
            try {
                const SQL = await initSqlJs({
                    locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${file}`
                });

                // Try to load existing database from localStorage
                const savedDb = localStorage.getItem('aviladb');
                if (savedDb) {
                    const uint8Array = new Uint8Array(JSON.parse(savedDb));
                    db = new SQL.Database(uint8Array);
                    console.log('‚úÖ Database loaded from localStorage');
                } else {
                    db = new SQL.Database();
                    console.log('‚úÖ New database created');
                }

                // Create tables if they don't exist
                db.run(`
                    CREATE TABLE IF NOT EXISTS metrics (
                        id INTEGER PRIMARY KEY AUTOINCREMENT,
                        timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
                        metric_name TEXT NOT NULL,
                        metric_value REAL NOT NULL,
                        metric_unit TEXT
                    );
                `);

                db.run(`
                    CREATE TABLE IF NOT EXISTS events (
                        id INTEGER PRIMARY KEY AUTOINCREMENT,
                        timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
                        event_type TEXT NOT NULL,
                        event_data TEXT,
                        severity TEXT DEFAULT 'info'
                    );
                `);

                db.run(`
                    CREATE TABLE IF NOT EXISTS users_activity (
                        id INTEGER PRIMARY KEY AUTOINCREMENT,
                        timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
                        user_count INTEGER NOT NULL,
                        active_sessions INTEGER
                    );
                `);

                console.log('‚úÖ Tables created/verified');

                // Seed some initial data if database is new
                if (!savedDb) {
                    seedInitialData();
                }

                return db;
            } catch (err) {
                console.error('‚ùå Database initialization error:', err);
                showNotification('Database Error', 'Failed to initialize SQLite database', 'danger');
            }
        }

        // Save database to localStorage
        function saveDatabase() {
            if (db) {
                const data = db.export();
                const buffer = JSON.stringify(Array.from(data));
                localStorage.setItem('aviladb', buffer);
                console.log('üíæ Database saved to localStorage');
            }
        }

        // Seed initial data
        function seedInitialData() {
            const now = Date.now();

            // Add sample metrics
            for (let i = 0; i < 24; i++) {
                const timestamp = new Date(now - (24 - i) * 3600000).toISOString();
                db.run('INSERT INTO metrics (timestamp, metric_name, metric_value, metric_unit) VALUES (?, ?, ?, ?)',
                    [timestamp, 'events_per_min', Math.floor(Math.random() * 2000) + 500, 'count']);
                db.run('INSERT INTO metrics (timestamp, metric_name, metric_value, metric_unit) VALUES (?, ?, ?, ?)',
                    [timestamp, 'latency', Math.floor(Math.random() * 60) + 20, 'ms']);
            }

            // Add sample events
            const eventTypes = ['user_login', 'api_call', 'database_query', 'cache_hit', 'error'];
            const severities = ['info', 'warning', 'error'];
            for (let i = 0; i < 50; i++) {
                const timestamp = new Date(now - Math.random() * 86400000).toISOString();
                db.run('INSERT INTO events (timestamp, event_type, event_data, severity) VALUES (?, ?, ?, ?)',
                    [timestamp, eventTypes[Math.floor(Math.random() * eventTypes.length)],
                     JSON.stringify({ detail: 'Sample event data' }),
                     severities[Math.floor(Math.random() * severities.length)]]);
            }

            saveDatabase();
            console.log('üå± Initial data seeded');
        }

        // Query helpers
        function queryMetrics(metricName, limit = 24) {
            const stmt = db.prepare('SELECT * FROM metrics WHERE metric_name = ? ORDER BY timestamp DESC LIMIT ?');
            stmt.bind([metricName, limit]);
            const results = [];
            while (stmt.step()) {
                results.push(stmt.getAsObject());
            }
            stmt.free();
            return results.reverse();
        }

        function insertMetric(metricName, value, unit = '') {
            db.run('INSERT INTO metrics (metric_name, metric_value, metric_unit) VALUES (?, ?, ?)',
                [metricName, value, unit]);
            saveDatabase();
        }

        function getRecentEvents(limit = 10) {
            const stmt = db.prepare('SELECT * FROM events ORDER BY timestamp DESC LIMIT ?');
            stmt.bind([limit]);
            const results = [];
            while (stmt.step()) {
                results.push(stmt.getAsObject());
            }
            stmt.free();
            return results;
        }

        // Initialize database on load
        initDatabase();

        // Save database before page unload
        window.addEventListener('beforeunload', saveDatabase);

        // ========== Original Dashboard Code ==========
        // Generate time labels
        function generateTimeLabels(period) {
            const labels = [];
            const points = period === '1h' ? 12 : period === '24h' ? 24 : 30;

            for (let i = points - 1; i >= 0; i--) {
                const date = new Date();
                if (period === '1h') {
                    date.setMinutes(date.getMinutes() - i * 5);
                    labels.push(date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }));
                } else if (period === '24h') {
                    date.setHours(date.getHours() - i);
                    labels.push(date.toLocaleTimeString('pt-BR', { hour: '2-digit' }) + 'h');
                } else {
                    date.setDate(date.getDate() - i);
                    labels.push(date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }));
                }
            }
            return labels;
        }

        // Generate random data with trend
        function generateData(points, min, max, trend = 0) {
            const data = [];
            let current = min + Math.random() * (max - min);

            for (let i = 0; i < points; i++) {
                current += (Math.random() - 0.5) * (max - min) * 0.1 + trend;
                current = Math.max(min, Math.min(max, current));
                data.push(Math.round(current));
            }
            return data;
        }

        // Chart.js default config for dark theme
        Chart.defaults.color = '#98989D';
        Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';

        // Events Chart
        const eventsCtx = document.getElementById('eventsChart').getContext('2d');
        const eventsChart = new Chart(eventsCtx, {
            type: 'line',
            data: {
                labels: generateTimeLabels('24h'),
                datasets: [{
                    label: 'Eventos/min',
                    data: generateData(24, 500, 2000, 10),
                    borderColor: '#0A84FF',
                    backgroundColor: 'rgba(10, 132, 255, 0.2)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Users Chart
        const usersCtx = document.getElementById('usersChart').getContext('2d');
        const usersChart = new Chart(usersCtx, {
            type: 'line',
            data: {
                labels: generateTimeLabels('24h'),
                datasets: [{
                    label: 'Usu√°rios',
                    data: generateData(24, 100, 500, 5),
                    borderColor: '#34C759',
                    backgroundColor: 'rgba(52, 199, 89, 0.2)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Latency Chart
        const latencyCtx = document.getElementById('latencyChart').getContext('2d');
        const latencyChart = new Chart(latencyCtx, {
            type: 'line',
            data: {
                labels: generateTimeLabels('24h'),
                datasets: [{
                    label: 'Lat√™ncia (ms)',
                    data: generateData(24, 20, 80, -0.5),
                    borderColor: '#FFD60A',
                    backgroundColor: 'rgba(255, 214, 10, 0.2)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Errors Chart (Doughnut)
        const errorsCtx = document.getElementById('errorsChart').getContext('2d');
        const errorsChart = new Chart(errorsCtx, {
            type: 'doughnut',
            data: {
                labels: ['4xx Errors', '5xx Errors', 'Timeouts', 'Network'],
                datasets: [{
                    data: [45, 25, 20, 10],
                    backgroundColor: [
                        '#FF375F',
                        '#FFD60A',
                        '#BF5AF2',
                        '#0A84FF'
                    ],
                    borderWidth: 2,
                    borderColor: '#000000'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Live metrics update
        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            const range = end - start;
            let current = start;
            const increment = range / (duration / 16);

            const timer = setInterval(() => {
                current += increment;
                if (current >= end) {
                    current = end;
                    clearInterval(timer);
                }

                if (id === 'avgLatency' || id === 'errorRate') {
                    obj.innerHTML = Math.round(current) + (id === 'avgLatency' ? '<span style="font-size: 1rem;">ms</span>' : '<span style="font-size: 1rem;">%</span>');
                } else {
                    obj.textContent = Math.round(current).toLocaleString('pt-BR');
                }
            }, 16);
        }

        // Update metrics
        function updateMetrics() {
            animateValue('totalEvents', 0, Math.floor(Math.random() * 50000) + 100000, 1000);
            animateValue('activeUsers', 0, Math.floor(Math.random() * 500) + 1500, 1000);
            animateValue('avgLatency', 0, Math.floor(Math.random() * 30) + 35, 1000);
            animateValue('errorRate', 0, (Math.random() * 1).toFixed(2), 1000);
        }

        // WebSocket simulation
        function simulateWebSocket() {
            setInterval(() => {
                // Update charts with new data
                const charts = [eventsChart, usersChart, latencyChart];
                charts.forEach(chart => {
                    chart.data.labels.shift();
                    chart.data.labels.push(new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }));

                    chart.data.datasets.forEach(dataset => {
                        dataset.data.shift();
                        const lastValue = dataset.data[dataset.data.length - 1];
                        const newValue = lastValue + (Math.random() - 0.5) * lastValue * 0.1;
                        dataset.data.push(Math.max(0, newValue));
                    });

                    chart.update('none');
                });

                // Random notifications
                if (Math.random() > 0.7) {
                    const notifications = [
                        { type: 'success', title: 'M√©trica Normal', message: 'Lat√™ncia abaixo de 50ms' },
                        { type: 'warning', title: 'Alerta', message: 'CPU acima de 80%' },
                        { type: 'danger', title: 'Erro Cr√≠tico', message: 'Falha na conex√£o DB' }
                    ];
                    const notif = notifications[Math.floor(Math.random() * notifications.length)];
                    showNotification(notif.type, notif.title, notif.message);
                }
            }, 5000);
        }

        // Show notification
        function showNotification(type, title, message) {
            const container = document.getElementById('notifications');
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;

            const icons = {
                success: '‚úÖ',
                warning: '‚ö†Ô∏è',
                danger: 'üö®'
            };

            notif.innerHTML = `
                <span class="notification-icon">${icons[type]}</span>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">√ó</button>
            `;

            container.appendChild(notif);

            setTimeout(() => notif.remove(), 5000);
        }

        // Export data
        function exportData() {
            const data = {
                timestamp: new Date().toISOString(),
                totalEvents: document.getElementById('totalEvents').textContent,
                activeUsers: document.getElementById('activeUsers').textContent,
                avgLatency: document.getElementById('avgLatency').textContent,
                errorRate: document.getElementById('errorRate').textContent
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pulse-metrics-${Date.now()}.json`;
            a.click();

            showNotification('success', 'Exportado', 'Dados exportados com sucesso!');
        }

        // Show Database Statistics
        function showDatabaseStats() {
            if (!db) {
                showNotification('warning', 'Database', 'Database not initialized yet');
                return;
            }

            try {
                // Get counts
                const metricsCount = db.exec('SELECT COUNT(*) as count FROM metrics')[0].values[0][0];
                const eventsCount = db.exec('SELECT COUNT(*) as count FROM events')[0].values[0][0];
                const usersCount = db.exec('SELECT COUNT(*) as count FROM users_activity')[0].values[0][0];

                // Get recent events
                const recentEvents = getRecentEvents(5);

                // Get latest metrics
                const latestMetrics = queryMetrics('events_per_min', 5);

                console.log('%cüìä AVILA PULSE DATABASE STATS', 'font-size: 20px; font-weight: bold; color: #0A84FF;');
                console.log('%c‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'color: #BF5AF2;');
                console.log(`\nüìà Total Metrics: ${metricsCount}`);
                console.log(`üéØ Total Events: ${eventsCount}`);
                console.log(`üë• User Activity Records: ${usersCount}`);
                console.log(`\nüíæ Database Size: ${JSON.stringify(Array.from(db.export())).length / 1024} KB`);
                console.log('\nüî• Recent Events:');
                console.table(recentEvents);
                console.log('\nüìä Latest Metrics:');
                console.table(latestMetrics);
                console.log('%c‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'color: #BF5AF2;');
                console.log('%cTip: Use queryMetrics(), getRecentEvents(), or run custom SQL with db.exec()', 'color: #98989D; font-style: italic;');

                showNotification('success', 'Database Stats', `${metricsCount} metrics, ${eventsCount} events logged. Check console (F12) for details.`);
            } catch (err) {
                console.error('Error getting database stats:', err);
                showNotification('danger', 'Error', 'Failed to get database stats');
            }
        }

        // Change chart period
        function changeChartPeriod(chartName, period) {
            event.target.parentElement.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update chart labels and data based on period
            const points = period === '1h' ? 12 : period === '24h' ? 24 : 30;

            if (chartName === 'events') {
                eventsChart.data.labels = generateTimeLabels(period);
                eventsChart.data.datasets[0].data = generateData(points, 500, 2000, 10);
                eventsChart.update();
            } else if (chartName === 'users') {
                usersChart.data.labels = generateTimeLabels(period);
                usersChart.data.datasets[0].data = generateData(points, 100, 500, 5);
                usersChart.update();
            } else if (chartName === 'latency') {
                latencyChart.data.labels = generateTimeLabels(period);
                latencyChart.data.datasets[0].data = generateData(points, 20, 80, -0.5);
                latencyChart.update();
            }
        }

        // Update charts on filter change
        function updateCharts() {
            showNotification('success', 'Atualizado', 'Filtros aplicados com sucesso!');
        }

        // Toggle settings
        function toggleSettings() {
            const modal = document.getElementById('settingsModal');
            modal.classList.toggle('active');

            if (modal.classList.contains('active')) {
                loadSettings();
            }
        }

        // Load settings from localStorage
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('pulseSettings') || '{}');

            document.getElementById('desktopNotifications').checked = settings.desktopNotifications || false;
            document.getElementById('errorAlerts').checked = settings.errorAlerts !== false;
            document.getElementById('soundAlerts').checked = settings.soundAlerts || false;
            document.getElementById('refreshInterval').value = settings.refreshInterval || '10000';
            document.getElementById('autoRefresh').checked = settings.autoRefresh !== false;
            document.getElementById('chartTheme').value = settings.chartTheme || 'gradient';
            document.getElementById('animations').checked = settings.animations !== false;
            document.getElementById('dataPoints').value = settings.dataPoints || '24';
            document.getElementById('dbAutoSave').checked = settings.dbAutoSave !== false;
            document.getElementById('dataRetention').value = settings.dataRetention || '72';
        }

        // Save settings to localStorage
        function saveSettings() {
            const settings = {
                desktopNotifications: document.getElementById('desktopNotifications').checked,
                errorAlerts: document.getElementById('errorAlerts').checked,
                soundAlerts: document.getElementById('soundAlerts').checked,
                refreshInterval: document.getElementById('refreshInterval').value,
                autoRefresh: document.getElementById('autoRefresh').checked,
                chartTheme: document.getElementById('chartTheme').value,
                animations: document.getElementById('animations').checked,
                dataPoints: document.getElementById('dataPoints').value,
                dbAutoSave: document.getElementById('dbAutoSave').checked,
                dataRetention: document.getElementById('dataRetention').value
            };

            localStorage.setItem('pulseSettings', JSON.stringify(settings));
            console.log('‚öôÔ∏è Settings saved:', settings);
        }

        // Reset settings to defaults
        function resetSettings() {
            if (confirm('Tem certeza que deseja restaurar todas as configura√ß√µes para os valores padr√£o?')) {
                localStorage.removeItem('pulseSettings');
                loadSettings();
                showNotification('success', 'Configura√ß√µes', 'Configura√ß√µes restauradas para os valores padr√£o');
            }
        }

        // Request desktop notification permission
        document.getElementById('desktopNotifications').addEventListener('change', function() {
            if (this.checked && 'Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        new Notification('Avila Pulse', {
                            body: 'Notifica√ß√µes desktop ativadas!',
                            icon: 'favicon.svg'
                        });
                    } else {
                        this.checked = false;
                        showNotification('warning', 'Permiss√£o Negada', 'Habilite notifica√ß√µes nas configura√ß√µes do navegador');
                    }
                });
            }
        });

        // Initialize
        updateMetrics();
        simulateWebSocket();

        // Set default dates
        document.getElementById('endDate').valueAsDate = new Date();
        const startDate = new Date();
        startDate.setDate(startDate.getDate() - 7);
        document.getElementById('startDate').valueAsDate = startDate;
    </script>

    <!--Start of Tawk.to Script-->
    <script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
    var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/694f28753169ac197f3faf8d/1jdejc2qr';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
    })();
    </script>
    <!--End of Tawk.to Script-->
</body>

</html>
